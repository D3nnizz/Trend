<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trend EMA Gradient Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { background: #f0f0f0; font-family: sans-serif; }
    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f0f0f0;
      border-radius: 1.5rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      border: 2px solid #3b82f6;
    }
    h1 {
      text-align: center;
      padding: 1rem;
      color: #60a5fa;
      font-size: 2rem;
      font-weight: 800;
    }
    select {
      display: block;
      margin: 1rem auto;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      border: none;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      color: #0000ff;
      font-weight: bold;
      cursor: pointer;
    }
    canvas { width: 100% !important; height: 650px !important; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š Trend EMA Dashboard</h1>
    <select id="fileSelect">
      <option value="data/trend_3m.csv">Trend 3 minuten</option>
      <option value="data/trend_5m.csv">Trend 5 minuten</option>
      <option value="data/trend_15m.csv">Trend 15 minuten</option>
      <option value="data/trend_30m.csv">Trend 30 minuten</option>
      <option value="data/trend_1h.csv">Trend 1 uur</option>
      <option value="data/trend_4h.csv">Trend 4 uur</option>
      <option value="data/trend_1d.csv">Trend 1 dag</option>
    </select>
    <canvas id="trendChart"></canvas>
  </div>

  <script>
    const ctx = document.getElementById('trendChart').getContext('2d');
    let chart;

    async function loadCSV(filePath) {
      return new Promise((resolve, reject) => {
        Papa.parse(filePath, {
          download: true,
          header: true,
          dynamicTyping: true,
          complete: (results) => resolve(results.data),
          error: (err) => reject(err),
        });
      });
    }

async function updateChart() {
  const filePath = document.getElementById('fileSelect').value;
  const data = await loadCSV(filePath);
  const labels = data.map(row => row.timestamp);
  const trendEMA = data.map(row => row.trend_ema);

  if (chart) chart.destroy();

  // find max absolute value for symmetric axis
  const maxAbs = Math.max(...trendEMA.map(v => Math.abs(v)));

  // custom plugin to draw zero line
  const zeroLinePlugin = {
    id: 'zeroLine',
    afterDraw: (chart) => {
      const { ctx, scales: { y, x } } = chart;
      const yZero = y.getPixelForValue(0);
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(x.left, yZero);
      ctx.lineTo(x.right, yZero);
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#000'; // bold black
      ctx.stroke();
      ctx.restore();
    }
  };

  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Trend EMA',
        data: trendEMA,
        borderWidth: 3,
        fill: false,
        pointRadius: 0,
        borderColor: (context) => {
          const chart = context.chart;
          const { ctx, chartArea } = chart;
          if (!chartArea) return '#3b82f6';
          const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
          gradient.addColorStop(0, '#ef4444');
          gradient.addColorStop(0.45, '#f97316');
          gradient.addColorStop(0.55, '#22c55e');
          gradient.addColorStop(1, '#22c55e');
          return gradient;
        },
        tension: 0.25,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      backgroundColor: '#f0f0f0',
      scales: {
        y: {
          title: { display: true, text: 'Trend EMA' },
          grid: { color: '#ddd' },
          min: -maxAbs,   // symmetric scale
          max: maxAbs,   // symmetric scale
          ticks: { 
            color: '#1e3a8a',
            callback: function(value) {
              return value.toFixed(4);
            }
          }
        },
        x: {
          ticks: { maxTicksLimit: 10, color: '#1e3a8a' },
          grid: { color: '#eee' }
        }
      },
      plugins: {
        legend: { display: false }
      }
    },
    plugins: [zeroLinePlugin]
  });
}


    document.getElementById('fileSelect').addEventListener('change', updateChart);

    updateChart();
    setInterval(updateChart, 60000);
  </script>
</body>
</html>