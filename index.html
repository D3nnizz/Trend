<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trend Chart</title>
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #fafafa;
    }
    #controls {
      margin-bottom: 20px;
    }
    #chart {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label for="timeframe">Select Timeframe: </label>
    <select id="timeframe">
      <option value="trend_3m.csv">3 Minutes</option>
      <option value="trend_5m.csv">5 Minutes</option>
      <option value="trend_15m.csv">15 Minutes</option>
      <option value="trend_30m.csv">30 Minutes</option>
      <option value="trend_1h.csv">1 Hour</option>
      <option value="trend_4h.csv">4 Hours</option>
      <option value="trend_1d.csv">1 Day</option>
    </select>
  </div>

  <div id="chart"></div>

  <script>
    function loadCSV(file) {
      Papa.parse("data/" + file, {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
          renderChart(results.data);
        }
      });
    }

    function renderChart(data) {
      const timestamps = data.map(row => row.timestamp);
      const values = data.map(row => row.rel_change);

      // Create colorscale based on values
      const colors = values.map(v => {
        if (v > 0.01) return 'green';
        if (v < -0.01) return 'red';
        return 'yellow';
      });

      const trace = {
        x: timestamps,
        y: values,
        mode: 'lines',
        line: {
          color: 'rgba(0,0,0,0)', // placeholder, weâ€™ll use per-point coloring
          width: 3
        },
        text: values.map(v => v.toFixed(4)),
        hoverinfo: 'x+y',
        marker: { color: colors }
      };

      const layout = {
        title: 'Trend Relative Change',
        xaxis: { title: 'Time' },
        yaxis: { title: 'Percent', zeroline: true, zerolinewidth: 2, zerolinecolor: 'black' },
        showlegend: false,
        plot_bgcolor: '#fff',
        paper_bgcolor: '#fff'
      };

      Plotly.newPlot('chart', [trace], layout);
    }

    // Load default timeframe
    loadCSV('trend_3m.csv');

    document.getElementById('timeframe').addEventListener('change', function() {
      loadCSV(this.value);
    });
  </script>
</body>
</html>
