<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gradient Line Plot</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
</head>
<body>
    <h2>Gradient Line Plot</h2>
    <div id="chart" style="width: 100%; height: 600px;"></div>

    <script>
        d3.csv("data/trend_3m.csv").then(function(rows) {
            // Convert CSV strings to proper types
            var x = rows.map(r => new Date(r.timestamp));
            var y = rows.map(r => parseFloat(r.trend_ema));

            // Generate segments for gradient coloring
            var traces = [];
            for (var i = 0; i < x.length - 1; i++) {
                traces.push({
                    x: [x[i], x[i+1]],
                    y: [y[i], y[i+1]],
                    mode: 'lines',
                    line: {
                        color: y[i],
                        colorscale: [[0,'red'],[0.5,'yellow'],[1,'green']],
                        width: 3
                    },
                    type: 'scatter',
                    showlegend: false
                });
            }

            var layout = {
                plot_bgcolor: 'white',
                margin: { t: 20, b: 20, l: 20, r: 20 },
                xaxis: { showgrid: false, zeroline: false, mirror: true, linecolor: 'gray' },
                yaxis: { showgrid: false, zeroline: false, mirror: true, linecolor: 'gray', side: 'right' },
                coloraxis: {
                    colorscale: [[0,'red'],[0.5,'yellow'],[1,'green']],
                    colorbar: { title: "Y value" }
                }
            };

            Plotly.newPlot('chart', traces, layout);
        });
    </script>
</body>
</html>
