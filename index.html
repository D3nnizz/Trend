<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trend EMA Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f0f0f0; }
    .gradient-header {
      background: linear-gradient(90deg, #1e3a8a, #3b82f6, #ef4444);
      color: white;
    }
    .card-shape {
      border-radius: 1.5rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      overflow: hidden;
      border: 2px solid #3b82f6;
    }
    .fancy-select {
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 1rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
    }
    .fancy-select option {
      color: black;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-6">
  <div class="card-shape bg-white w-full max-w-5xl">
    <!-- Header -->
    <div class="gradient-header text-center py-4">
      <h1 class="text-3xl font-extrabold tracking-wide">ðŸ“Š Trend EMA Dashboard</h1>
    </div>

    <!-- Dropdown -->
    <div class="flex justify-center py-6">
      <select id="fileSelect" class="fancy-select">
        <option value="data/trend_1h.csv">Trend 1H</option>
        <option value="data/trend_3m.csv">Trend 3M</option>
        <option value="data/trend_5m.csv">Trend 5M</option>
      </select>
    </div>

    <!-- Chart -->
    <div id="chart" class="w-full h-[500px] px-4 pb-6"></div>
  </div>

  <script>
    const chartDiv = document.getElementById('chart');
    const fileSelect = document.getElementById('fileSelect');

    async function loadCSV(filePath) {
      return new Promise((resolve, reject) => {
        Papa.parse(filePath, {
          download: true,
          header: true,
          dynamicTyping: true,
          complete: (results) => resolve(results.data),
          error: (err) => reject(err),
        });
      });
    }

    async function updateChart() {
      const filePath = fileSelect.value;
      const data = await loadCSV(filePath);
      const timestamps = data.map(row => row.timestamp);
      const trendEMA = data.map(row => row.trend_ema);

      const gradientColors = trendEMA.map(v => v >= 0 ? '#22c55e' : (v > -0.5 ? '#f97316' : '#ef4444'));

      const traceGradient = {
        x: timestamps,
        y: trendEMA,
        mode: 'lines',
        line: {
          width: 3,
          color: gradientColors,
        },
        hovertemplate: '%{y:.4f}<extra></extra>'
      };

      const layout = {
        title: {
          text: 'Trend EMA Overview',
          font: { size: 22, color: '#1e3a8a' }
        },
        paper_bgcolor: '#f0f0f0',
        plot_bgcolor: '#f0f0f0',
        xaxis: { title: 'Timestamp', showgrid: false, color: '#1e3a8a' },
        yaxis: {
          title: 'Trend EMA',
          zeroline: true,
          zerolinewidth: 2,
          zerolinecolor: '#3b82f6',
          color: '#ef4444'
        },
        margin: { t: 50, r: 30, l: 60, b: 50 }
      };

      Plotly.newPlot(chartDiv, [traceGradient], layout, {responsive: true});
    }

    fileSelect.addEventListener('change', updateChart);

    // Initial load
    updateChart();

    // Auto refresh every 60 seconds
    setInterval(updateChart, 60000);
  </script>
</body>
</html>
